<?xml version="1.0" encoding="utf-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="UserManage">

  <!-- 取得指定用户名个数 -->
  <select id="countUserAccount" resultType="java.lang.Integer" parameterType="java.util.HashMap">
    select
      count(id) 
    from
      tu_user 
    where
      (name = #{account, jdbcType=VARCHAR } or email = #{account, jdbcType=VARCHAR })
    <if test = "password != null and password != ''" > 
      and CONVERT( 
        AES_DECRYPT(password, UNHEX(MD5('${DB_ENCODE_KEY}'))) 
          USING UTF8
      ) = #{password, jdbcType=CHAR }

    </if>
  </select>
  
  <select id="getUserInfo" resultType="zh.co.item.bank.model.entity.UserModel" parameterType="zh.co.item.bank.db.entity.TuUserBean">
    SELECT
      * 
    FROM
      vu_user_model
    where
      (name = #{name, jdbcType=VARCHAR } or email = #{name, jdbcType=VARCHAR })
      <choose>
      <when  test = "password != null and password != ''" > 
      and CONVERT( 
        AES_DECRYPT(password, UNHEX(MD5('${DB_ENCODE_KEY}'))) 
          USING UTF8
      ) = #{password, jdbcType=CHAR }
      and wechat = '0'
     </when >
     <otherwise>
      and wechat = '1'
     </otherwise>
     </choose>
  </select>
  
    <select id="selectUserById" parameterType="java.lang.Integer" resultType="zh.co.item.bank.model.entity.UserModel">
        select * from
        vu_user_model
        where id = #{id}
    </select>

</mapper>