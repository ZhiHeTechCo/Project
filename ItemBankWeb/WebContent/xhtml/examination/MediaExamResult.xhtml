<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<html xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core">
<ui:composition template="../../xhtml/common/examtemplate.xhtml">
	<ui:define name="content">
		<h:outputScript library="javax.faces" name="jsf.js" target="head" />
		<h:outputScript library="js" name="lightbox.js" />
		<style>
          .music_control {
          	display: block;
          	height: 50px;
          	width: 50px;
          	position: absolute;
          	right: 0px;
          	top: 0px;
          	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
          }
          
          @
          -webkit-keyframes a_music_play { 0%{-webkit-transform: rotate(0deg);}
          100%{-webkit-transform:rotate(360deg);}
          }
        </style>


		<script type="text/javascript">
          function getMediaFail() {
              var mediaMsg = document.getElementById("mediaMsg");
              mediaMsg.innerText = "音频加载失败,请刷新页面重试!";
              var loadImg = document.getElementById("loadImg");
              loadImg.src = "";
          }
          function getMediaCallBack(data) {
                var ajaxStatus = data.status;
                // status
                switch (ajaxStatus) {
                // begin
                case "begin":
                     var mediaMsg = document.getElementById("mediaMsg");
                     mediaMsg.innerText = "音频加载中,请稍后!";
                     var loadImg = document.getElementById("loadImg");
                     loadImg.src = "${request.contextPath}/resources/images/loading.gif";
                    break;
                // complete
                case "complete":
                    resetButtonDisabled();
                    break;
                case "success":
                    var audio = document.getElementById("listen");
                    if(audio == null || audio.src == "" ) {
                        getMediaFail();
                    } else {
                        var mediaMsg = document.getElementById("mediaMsg");
                        mediaMsg.innerText = "就绪";
                        var loadImg = document.getElementById("loadImg");
                        loadImg.src = "";
                    }
                    break;
             }
         }
        </script>
		<div style="width: 100%; overflow: auto; overflow-x: hidden;">
			<h:form id="mediaExamForm">
				<div class="typrography">
					<h2
						style="text-align: center; padding-bottom: 20px; color: #3382C9;">听力部分</h2>
					<div class="container">
						<div class="bs-example">
							<h:panelGroup id="ngossfw_error_display"
								class="#{request.getAttribute('request-message-level')}"
								layout="block">
								<h:outputText
									value="${request.getAttribute('request-message-content')}"
									escape="false" />
							</h:panelGroup>
							<c:choose>
								<c:when test="#{examBean.mediaModel ne null}">
									<c:when test="#{examBean.mediaModel.mediaPath ne null}">
										<div class="form-submit1">
											<h:commandButton id="btnGetMedia" value="开始"
												onclick="return cancelToken(this)">
												<f:ajax event="click" execute="@form" render="audioWrapper "
													listener="#{examBean.getMedia}" onevent="getMediaCallBack"
													onerror="getMediaFail" />
											</h:commandButton>
											<span id="mediaMsg"
												style="padding-left: 20px; color: #3382C9;"></span> <img
												id="loadImg" src="" />
										</div>

										<h:panelGroup id="audioWrapper">
											<!-- 显示音频 -->
											<div class="audio_wrap"
												style="display:#{examBean.mediaReady};">
												<div class="music_control">
													<audio id="listen" controls="controls"
														autobuffer="autobuffer"
														src="#{examBean.mediaModel.mediaPath}"></audio>
												</div>
											</div>

											<script type="text/javascript">
										    
                                            function load_ready(){
                                                audio_array[0].play();
                                                audio_array[0].loop=false;
                                            }

                                            /*声音脚本开始*/
                                            //音频标签存放数组
                                            var audio_array=[];
                                            function loadSound(){

                                        var audio = document.getElementById("listen");

                                          var audio_num=0;

                                          //获得json中图片的地址
                                          var audio = document.getElementById("listen");
                                          //audio.src = "${request.contextPath}/mp3/BIGBANG_SOBER.mp3";//地址
                                          audio.className="bg_music";

                                          audio_array.push(audio);
                                          $(".audio_wrap").append(audio);

                                          audio_array[0].load();
                                          audio_array[0].addEventListener("canplaythrough", function(){

                                          load_ready();

                                          });
    								}

    								/*声音脚本 结束*/
    								loadSound();
    								</script>
										</h:panelGroup>
										<!-- 显示大题目 -->
										<h:dataTable id="title" rendered="true"
											value="#{examResultBean.mediaQuestions}" var="item"
											width="100%">
											<h:column>
												<h4>#{item.title}</h4>
												<h:dataTable id="mq" class="table table-bordered"
													rendered="true" value="#{item.question}" var="mquestion"
													width="100%">
													<h:column>
														<h:outputText value="#{mquestion.context}"></h:outputText>
														<hr />
														<!-- 文字 -->
														<h:panelGroup
															rendered="#{mquestion.radioClass eq 'radioTable2'}">
															<div style="witdh: 5%; float: left;">
																<div
																	style="padding-bottom: 10px; width: 100%; margin-right: 5px;">
																	<h:panelGroup rendered="#{mquestion.answer eq '1'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-ok"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne mquestion.answer and mquestion.myAnswer eq '1'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-remove"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne '1' and mquestion.answer ne '1'}">
																		<span style="margin-top: 4px; color: #FFFFFF;"
																			class="glyphicon glyphicon-chevron-right"></span>
																	</h:panelGroup>
																</div>
																<div style="padding-bottom: 10px; width: 100%">
																	<h:panelGroup rendered="#{mquestion.answer eq '2'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-ok"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne mquestion.answer and mquestion.myAnswer eq '2'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-remove"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne '2' and mquestion.answer ne '2'}">
																		<span style="margin-top: 4px; color: #FFFFFF;"
																			class="glyphicon glyphicon-chevron-right"></span>
																	</h:panelGroup>
																</div>
																<div style="padding-bottom: 10px; width: 100%">
																	<h:panelGroup rendered="#{mquestion.answer eq '3'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-ok"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne mquestion.answer and mquestion.myAnswer eq '3'}">
																		<span class="glyphicon glyphicon-remove"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne '3' and mquestion.answer ne '3'}">
																		<span style="margin-top: 4px; color: #FFFFFF;"
																			class="glyphicon glyphicon-chevron-right"></span>
																	</h:panelGroup>
																</div>
																<div style="padding-bottom: 10px; width: 100%">
																	<h:panelGroup rendered="#{mquestion.answer eq '4'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-ok"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne mquestion.answer and mquestion.myAnswer eq '4'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-remove"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne '4' and mquestion.answer ne '4'}">
																		<span style="margin-top: 4px; color: #FFFFFF;"
																			class="glyphicon glyphicon-chevron-right"></span>
																	</h:panelGroup>
																</div>
															</div>
															<div style="float: left;">
																<h:selectOneRadio value="#{mquestion.myAnswer}"
																	layout="#{mquestion.layoutStyle}"
																	class="#{mquestion.radioClass}" readonly="true"
																	disabled="true">
																	<f:selectItem itemValue="1"
																		itemLabel="  A：#{mquestion.a}" />
																	<f:selectItem itemValue="2"
																		itemLabel="  B：#{mquestion.b}" />
																	<f:selectItem itemValue="3"
																		itemLabel="  C：#{mquestion.c}" />
																	<f:selectItem itemValue="4"
																		itemLabel="  D：#{mquestion.d}" />
																</h:selectOneRadio>
															</div>
														</h:panelGroup>
														<h:panelGroup
															rendered="#{mquestion.radioClass eq 'radioTable1'}">
															<div style="witdh: 100%;">
																<div style="width: 25%; margin-top: 5px; float: left;">
																	<h:panelGroup rendered="#{mquestion.answer eq '1'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-ok"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne mquestion.answer and mquestion.myAnswer eq '1'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-remove"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne '1' and mquestion.answer ne '1'}">
																		<span style="margin-top: 4px; color: #FFFFFF;"
																			class="glyphicon glyphicon-chevron-right"></span>
																	</h:panelGroup>
																</div>
																<div style="width: 25%; margin-top: 5px; float: left;">
																	<h:panelGroup rendered="#{mquestion.answer eq '2'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-ok"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne mquestion.answer and mquestion.myAnswer eq '2'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-remove"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne '2' and mquestion.answer ne '2'}">
																		<span style="margin-top: 4px; color: #FFFFFF;"
																			class="glyphicon glyphicon-chevron-right"></span>
																	</h:panelGroup>
																</div>
																<div style="width: 25%; margin-top: 5px; float: left;">
																	<h:panelGroup rendered="#{mquestion.answer eq '3'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-ok"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne mquestion.answer and mquestion.myAnswer eq '3'}">
																		<span class="glyphicon glyphicon-remove"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne '3' and mquestion.answer ne '3'}">
																		<span style="margin-top: 4px; color: #FFFFFF;"
																			class="glyphicon glyphicon-chevron-right"></span>
																	</h:panelGroup>
																</div>
																<div style="width: 25%; margin-top: 5px; float: left;">
																	<h:panelGroup rendered="#{mquestion.answer eq '4'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-ok"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne mquestion.answer and mquestion.myAnswer eq '4'}">
																		<span style="margin-top: 4px;"
																			class="glyphicon glyphicon-remove"></span>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{mquestion.myAnswer ne '4' and mquestion.answer ne '4'}">
																		<span style="margin-top: 4px; color: #FFFFFF;"
																			class="glyphicon glyphicon-chevron-right"></span>
																	</h:panelGroup>
																</div>
															</div>
															<div style="float: left; width: 100%;">
																<h:selectOneRadio value="#{mquestion.myAnswer}"
																	layout="#{mquestion.layoutStyle}"
																	class="#{mquestion.radioClass}" readonly="true"
																	disabled="true">
																	<f:selectItem itemValue="1"
																		itemLabel="  A：#{mquestion.a}" />
																	<f:selectItem itemValue="2"
																		itemLabel="  B：#{mquestion.b}" />
																	<f:selectItem itemValue="3"
																		itemLabel="  C：#{mquestion.c}" />
																	<f:selectItem itemValue="4"
																		itemLabel="  D：#{mquestion.d}" />
																</h:selectOneRadio>
															</div>
														</h:panelGroup>
														<!-- 图片 -->
														<c:if test="#{mquestion.contextImgCode !=''}">
															<table align="center">
																<tr>
																	<td align="center">
																		<div class="gallery-bottom">
																			<div class="col-md-3 gallery-grid">
																				<a class="example-image-link"
																					href="#{mquestion.contextImgCode}"
																					data-lightbox="example-set"><img
																					class="example-image"
																					src="#{mquestion.contextImgCode}" alt="" /></a>
																			</div>
																		</div>
																	</td>
																</tr>
															</table>
														</c:if>
													</h:column>
												</h:dataTable>
											</h:column>
										</h:dataTable>
									</c:when>
								</c:when>
							</c:choose>
							<c:if test="#{examResultBean.examFlag eq 'true'}">
								<div class="form-submit1">
									<h:commandButton value="查看考试成绩" class="button1"
										action="#{examResultBean.goBackToExamResult}"
										id="goBackToExamResultBtn" style="margin-right: 5px;" />
								</div>
							</c:if>
							<div class="form-submit1">
								<h:commandButton value="返回试题选择" class="button1"
									action="#{examResultBean.goBackToClassify}"
									id="goBackToClassifyBtn" />
							</div>
						</div>
					</div>
				</div>
			</h:form>
		</div>
	</ui:define>
</ui:composition>
</html>
